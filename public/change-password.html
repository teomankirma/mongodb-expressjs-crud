<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Change Password</title>
  <script>
    window.onload = function () {
      // Get user ID from localStorage
      const user = JSON.parse(localStorage.getItem("user"));
      const userId = user ? user._id : null;

      if (!user) {
        window.location.href = "/signin";
      }

      document.getElementById('changePasswordForm').addEventListener('submit', function (event) {
        event.preventDefault();

        const oldPassword = document.getElementById("oldPassword").value;
        const newPassword = document.getElementById("newPassword").value;
        const confirmPassword = document.getElementById("confirmPassword").value;


        if (!userId) {
          alert("User not found");
          return;
        }

        fetch("/change-password", {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            _id: userId,
            oldPassword,
            newPassword,
            confirmPassword,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            alert(data.message);
            if (data.message === "Password updated successfully") {
              window.location.href = "/dashboard";
            }
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      });
    };
  </script>
</head>

<body>
  <form id="changePasswordForm" method="post">
    <label for="oldPassword">Old Password:</label>
    <br />
    <input type="password" id="oldPassword" required minlength="8">
    <br />
    <label for="newPassword">New Password:</label>
    <br />
    <input type="password" id="newPassword" required minlength="8">
    <br />
    <label for="confirmPassword">Confirm Password:</label>
    <br />
    <input type="password" id="confirmPassword" required minlength="8">
    <br>
    <input type="submit" value="Save Changes">
  </form>
</body>

</html>